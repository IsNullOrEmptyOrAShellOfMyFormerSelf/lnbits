{% extends "base.html" %} {% from "macros.jinja" import window_vars with context
%} {% block page %}

<div class="row q-col-gutter-md justify-center">
  <div class="col">
    <q-card class="q-pa-md">
      <q-table
        row-key="id"
        :rows="auditEntries"
        :columns="auditTable.columns"
        v-model:pagination="auditTable.pagination"
        :filter="auditTable.search"
        :loading="auditTable.loading"
        @request="fetchAudit"
      >
        <template v-slot:header="props">
          <q-tr :props="props">
            <q-th v-for="col in props.cols" :key="col.name" :props="props">
              <q-input
                v-if="['ip_address', 'user_id', 'path', 'request_method', 'response_code',].includes(col.name)"
                v-model="searchData[col.name]"
                @keydown.enter="searchAuditBy(col.name)"
                dense
                type="text"
                filled
                :label="col.label"
              >
                <template v-slot:append>
                  <q-icon
                    name="search"
                    @click="searchAuditBy(col.name)"
                    class="cursor-pointer"
                  />
                </template>
              </q-input>

              <span v-else v-text="col.label"></span>
            </q-th>
          </q-tr>
        </template>
        <template v-slot:body="props">
          <q-tr auto-width :props="props">
            <q-td v-for="col in props.cols" :key="col.name" :props="props">
              <div v-if="col.name == 'created_at'">
                <q-btn
                  icon="description"
                  :disable="!props.row.request_details"
                  size="sm"
                  flat
                  class="cursor-pointer q-mr-xs"
                  @click="copyText(props.row[col.name])"
                >
                  <q-tooltip>Request Details</q-tooltip>
                </q-btn>

                <span v-text="formatDate(props.row.created_at)"></span>
                <q-tooltip v-if="props.row.delete_at">
                  <span
                    v-text="'Will be deleted at: ' + formatDate(props.row.delete_at)"
                  ></span>
                </q-tooltip>
              </div>
              <div
                v-else-if="['user_id', 'request_details'].includes(col.name)"
              >
                <q-btn
                  v-if="props.row[col.name]"
                  icon="content_copy"
                  size="sm"
                  flat
                  class="cursor-pointer q-mr-xs"
                  @click="copyText(props.row[col.name])"
                >
                  <q-tooltip>Copy</q-tooltip>
                </q-btn>
                <span v-text="shortify(props.row[col.name])"> </span>
                <q-tooltip>
                  <span v-text="props.row[col.name]"></span>
                </q-tooltip>
              </div>
              <span v-else v-text="props.row[col.name]"></span>
            </q-td>
          </q-tr>
        </template>
      </q-table>
    </q-card>
  </div>
</div>

{% endblock %} {% block scripts %} {{ window_vars(user) }}
<script src="{{ static_url_for('static', 'js/audit.js') }}"></script>
{% endblock %}
